<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>
<br>
<br>
<br>
<br>
<div align="center" style="margin-top: 20px"> 用户名<input type="text" id="username"></div>
<div align="center" style="margin-top: 20px"> 密码<input type="password" id="userpwd"></div>
<div  align="center"  style="margin-top: 20px"><span>验证码:<input type="text" id="code"></span><span id="verifyCode"></span></div>
<div align="center"><a href="modifyPwd.html" >修改密码</a></div>



<div align="center" style="margin-top: 20px">
    <img src="checkCode" height="30" width="100" id="checkCode" align="center">
</div>
<div align="center" style="margin-top: 20px"><input type="submit" value="登录" id="login"></div>
<div align="center" id="tip"></div>
</body>
<script>
    //切换验证码
    $("#checkCode").click(function () {
        change();
    })

    function change() {
        $("#checkCode").attr("src", "checkCode?q=" + Math.random())
    }

    document.onkeydown = function (e) {
        var code = e.charCode || e.keyCode;
        if (code == 13) {
            if ($("#username").val() == "") {
                alert("用户名不能为空")
            } else if ($("#userpwd").val() == "") {
                alert("密码不能为空")
            } else {
                login()
            }
        }
    }
    function login(){
        $.ajax({
            url: "CheckLogin",
            type: "POST",
            data: {code: $("#code").val(), username: $("#username").val(), userpwd: $("#userpwd").val()},
            success: function (res) {
                change();
                if (res == 3) {
                    $("#verifyCode").html("验证码错误")
                    $("#verifyCode").css("color", "red")
                    return
                } else {
                    $("#verifyCode").html("验证码正确")
                    $("#verifyCode").css("color", "green")
                }
                if (res == 1 || res == 2) {
                    if (location.pathname == "/CSDN/login.html") {
                        location.href = "index.html";
                    } else {
                        location.reload();
                    }
                } else {
                    $("#tip").html("用户名或密码错误")
                    $("#tip").css("color", "red")
                }

            },
            dataType: "json"
        });
    }
    $("#login").click(function () {
        if ($("#code").val() == "") {
            alert("验证码不能为空")
            return
        }
        if ($("#username").val() == "") {
            alert("用户名不能为空")
            return
        } else if ($("#userpwd").val() == "") {
            alert("密码不能为空")
            return
        }
        login()

    })

</script>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>
原密码:<input id="orginPwd" type="password" onblur="checkPwd()"><span id="regPwd"></span><br>
新密码:<input id="newPwd" type="password" onblur="modifyPwd()"><span id="regNewPwd"></span><br>
确认密码:<input id="sureNewPwd" type="password" onblur="sureNewPwd()"><span id="regSureNewPwd"></span><br>
<input type="button" value="确认修改" id="modify">
</body>
<script>
    var result = 0;

    //验证密码是否正确
    function checkPwd() {
        $.ajax({
            url: "user/judgPwd",
            type: "POST",
            data: {pwd: $("#orginPwd").val()},
            success: function (res) {
                result = res
                if (res == 1) {
                    $("#regPwd").html("密码正确")
                    $("#regPwd").css("color", "green")
                } else {
                    $("#regPwd").html("密码不正确")
                    $("#regPwd").css("color", "red")
                }
            },
            dataType: "json",
        });
        if (result == 1) {
            return true
        } else {
            return false
        }
    }

    //验证新密码的格式
    function modifyPwd() {
        var pwdPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[~!@&%#_])[a-zA-Z0-9~!@&%#_]{8,16}$/ //密码
        if (pwdPattern.test($("#newPwd").val())) {
            //密码
            $("#regNewPwd").html("正确")
            $("#regNewPwd").css("color", "green")
            return true
        } else {
            $("#regNewPwd").html("请输入必须包含一个大写，一个小写字母，一个数字，一个特殊字符，且长度为8到16位的密码")
            $("#regNewPwd").css("color", "red")
            return false
        }
    }

    //验证两次密码是否一样
    function sureNewPwd() {
        if ($("#newPwd").val() == $("#sureNewPwd").val() && $("#sureNewPwd").val() != "") {
            //确认密码
            $("#regSureNewPwd").html("正确")
            $("#regSureNewPwd").css("color", "green")
            return true;
        } else {
            $("#regSureNewPwd").html("两次密码不一致")
            $("#regSureNewPwd").css("color", "red")
            return false
        }
    }

    //修改密码
    $("#modify").click(function () {
        if (!checkPwd()) {
            alert("密码错误")
            return
        } else if (!modifyPwd()) {
            alert("新密码格式不对")
            return
        } else if (!sureNewPwd()) {
            alert("两次输入的密码不一致")
            return
        }
        $.ajax({
            url: "user/modifyPwd",
            type: "POST",
            data: {pwd: $("#newPwd").val()},
            success: function (res) {
                alert("修改成功")
                location.href = "login.html"
            },
            dataType: "json",
        });
    })

</script>

</html>